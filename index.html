<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>HIMERASPEDIZIONI</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
/* ... Tutto il CSS esistente rimane invariato ... */

/* Aggiungo solo lo stile per i pulsanti rimuovi pacco e lista pacchi */
#lista-pacchi li button {
    margin-left: 10px;
    cursor: pointer;
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 2px 6px;
}

#lista-pacchi li button:hover {
    background: #b02a37;
}
</style>
</head>
<body>
<div class="container">
    <!-- HEADER -->
    <div id="header-logo">
        <img src="Logo.png" alt="Logo Himeraspedizioni">
        <div>
            <h1>Himeraspedizioni</h1>
            <p>Servizio Spedizioni Online</p>
        </div>
    </div>

    <!-- FORM UNICO -->
    <form action="https://formsubmit.co/termini.imerese@postaexpress.it" method="POST" id="spedizione-form">
        <div class="form-side-by-side">
            <div>
                <h2>Dati del Mittente</h2>
                <label>Nome e Cognome / Ragione Sociale <strong>presenti sul citofono</strong>
                    <input type="text" name="mittente_nome" required />
                </label>
                <!-- Tutti gli altri campi mittente -->
                <label>Via/Piazza<input type="text" name="mittente_via" required /></label>
                <label>Numero civico<input type="text" name="mittente_numero" required /></label>
                <label>CAP<input type="text" name="mittente_cap" required /></label>
                <label>Citt√†<input type="text" name="mittente_citta" required /></label>
                <label>Provincia<input type="text" name="mittente_provincia" required /></label>
                <label>Nazione<input type="text" name="mittente_nazione" required /></label>
                <label>Email<input type="email" name="mittente_email"/></label>
                <label>Telefono / WhatsApp<input type="text" name="mittente_telefono" required /></label>
                <label>Codice Fiscale / P.IVA<input type="text" name="mittente_cf" /></label>
                <label>Note per il corriere<textarea name="mittente_note"></textarea></label>
            </div>

            <div>
                <h2>Dati del Destinatario</h2>
                <label>Nome e Cognome / Ragione Sociale <strong>presenti sul citofono</strong>
                    <input type="text" name="destinatario_nome" required />
                </label>
                <!-- Tutti gli altri campi destinatario -->
                <label>Via/Piazza<input type="text" name="destinatario_via" required /></label>
                <label>Numero civico<input type="text" name="destinatario_numero" required /></label>
                <label>CAP<input type="text" name="destinatario_cap" required /></label>
                <label>Citt√†<input type="text" name="destinatario_citta" required /></label>
                <label>Provincia<input type="text" name="destinatario_provincia" required /></label>
                <label>Nazione<input type="text" name="destinatario_nazione" required /></label>
                <label>Email<input type="email" name="destinatario_email"/></label>
                <label>Telefono / WhatsApp<input type="text" name="destinatario_telefono" required /></label>
                <label>Note per la consegna<textarea name="destinatario_note"></textarea></label>
            </div>
        </div>

        <!-- DATI PACCHI -->
        <div class="section tariffe">
            <fieldset>
                <legend>Dati del pacco</legend>
                <label>Peso (kg)<input type="number" id="peso" step="0.01" min="0"></label>
                <label>Lunghezza (cm)<input type="number" id="lunghezza" step="0.1" min="0"></label>
                <label>Larghezza (cm)<input type="number" id="larghezza" step="0.1" min="0"></label>
                <label>Altezza (cm)<input type="number" id="altezza" step="0.1" min="0"></label>
                <label>Zona spedizione
                    <select id="zona">
                        <option value="nazionale">Nazionale</option>
                        <option value="europa">Europa</option>
                    </select>
                </label>
                <button type="button" id="aggiungi-pacco">Aggiungi pacco</button>
            </fieldset>

            <div id="lista-pacchi">
                <h3>Pacchi inseriti:</h3>
                <ul></ul>
            </div>
        </div>

        <!-- Checkbox termini -->
        <label>
            <input type="checkbox" id="accetto_condizioni" name="accetto_condizioni" value="Accetto i termini e condizioni" required>
            Accetto i termini e condizioni
        </label>

        <!-- Hidden FormSubmit -->
        <input type="hidden" name="_next" value="https://spedireveloce.github.io/SPEDIREVELOCE/grazie.html">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="ordine_id" id="ordine_id" value="">
        <input type="hidden" name="totale_pagato" id="totale_pagato" value="">

        <button type="submit" id="totale-paga" class="submit-btn">Totale: ‚Ç¨0.00 - Paga</button>
    </form>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const ordineIdInput = document.getElementById("ordine_id");
    ordineIdInput.value = 'ORD' + Date.now();

    const listaPacchi = document.querySelector("#lista-pacchi ul");
    const aggiungiBtn = document.getElementById("aggiungi-pacco");
    const zonaSelect = document.getElementById("zona");
    const totalePagaBtn = document.getElementById("totale-paga");
    const totaleInput = document.getElementById("totale_pagato");
    const form = document.getElementById("spedizione-form");

    function calcolaCostoTotale() {
        let totale = 0;
        listaPacchi.querySelectorAll("input[name='pacchi[]']").forEach(input => {
            const pacco = JSON.parse(input.value);
            const peso = parseFloat(pacco.peso);
            const zona = pacco.zona;
            if (zona === "nazionale") {
                if (peso <= 10) totale += 10;
                else if (peso <= 30) totale += 13.90;
            } else if (zona === "europa") {
                if (peso <= 10) totale += 30;
                else if (peso <= 20) totale += 35;
                else if (peso <= 30) totale += 40;
            }
        });
        return totale;
    }

    function aggiornaTotale() {
        const totale = calcolaCostoTotale();
        totalePagaBtn.textContent = `Totale: ‚Ç¨${totale.toFixed(2)} - Paga`;
        totaleInput.value = totale.toFixed(2);
    }

    aggiungiBtn.addEventListener("click", () => {
        const peso = document.getElementById("peso").value.trim();
        const lunghezza = document.getElementById("lunghezza").value.trim();
        const larghezza = document.getElementById("larghezza").value.trim();
        const altezza = document.getElementById("altezza").value.trim();
        const zona = zonaSelect.value;

        if (!peso || !lunghezza || !larghezza || !altezza) {
            alert("Compila tutti i campi del pacco prima di aggiungerlo.");
            return;
        }

        const li = document.createElement("li");
        li.textContent = `Peso: ${peso} kg, Dimensioni: ${lunghezza}x${larghezza}x${altezza} cm, Zona: ${zona}`;

        const paccoData = JSON.stringify({peso, lunghezza, larghezza, altezza, zona});
        const inputHidden = document.createElement("input");
        inputHidden.type = "hidden";
        inputHidden.name = "pacchi[]";
        inputHidden.value = paccoData;
        li.appendChild(inputHidden);

        const btnRimuovi = document.createElement("button");
        btnRimuovi.type = "button";
        btnRimuovi.textContent = "üóëÔ∏è";
        btnRimuovi.addEventListener("click", () => { li.remove(); aggiornaTotale(); });
        li.appendChild(btnRimuovi);

        listaPacchi.appendChild(li);

        // reset campi
        document.getElementById("peso").value = "";
        document.getElementById("lunghezza").value = "";
        document.getElementById("larghezza").value = "";
        document.getElementById("altezza").value = "";
        zonaSelect.value = "nazionale";

        aggiornaTotale();
    });

    form.addEventListener("submit", (e) => {
        if (listaPacchi.children.length === 0) {
            e.preventDefault();
            alert("Devi aggiungere almeno un pacco prima di inviare il modulo.");
            return;
        }
        if (!document.getElementById("accetto_condizioni").checked) {
            e.preventDefault();
            alert("Devi accettare i termini e condizioni.");
            return;
        }
        aggiornaTotale();
    });
});
</script>
</body>
</html>
